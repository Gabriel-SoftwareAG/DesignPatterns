= פרק 1: תבנית הסינגלטון

ifndef::already_included_config[]
include::config.adoc[]
endif::[]

:imagesdir: ../images/ch01_Singleton

== הקדמה

[cols="2", frame="none", grid="none"]
|===
|דמיין שהעיר שלך החליטה שתהיה רק ספרייה אחת, המרכז לכל אוהבי הספרים. ספרייה זו מיוחדת מכיוון שהיא המקום היחיד שכולם יכולים ללכת אליו כדי להשאיל ספרים, לקרוא ולשתף ידע. אם אתה רוצה ספר, אתה הולך לספרייה הזו, ואם מישהו אחר צריך את אותו הספר, הוא גם יבקר באותה ספרייה. אין אפשרות לבנות ספרייה נוספת; זו היא היחידה. היא הופכת לנקודת המפגש לכל צרכי הקריאה של כולם, ומבטיחה שכל השאלת ושיתוף הספרים מתרחשים במקום אחד ומנוהל.

בעולם התוכנה, תבנית הסינגלטון היא כמו להיות עם ספרייה אחת כזו בעיר.
|image:singleton_library.jpg[width=320, scale=50%]
|===

היא מבטיחה שמחלקה מסוימת בתוכנה תוכל להיות מופעלת פעם אחת ויחידה. המופע הייחודי הזה הופך לנקודת הגישה המרכזית לשירות או למשאב ברחבי היישום. כמו ספרייה היחידה בעיר, תבנית הסינגלטון מספקת נקודת ייחוס גלובלית אחת למשאב או לשירות שהיא מייצגת, ומבטיחה שכולם יעברו דרכה כדי לגשת ליכולות שהיא מציעה.

== רכיבים מרכזיים
- _מופע ייחודי_: תבנית הסינגלטון מבטיחה שרק מופע אחד של מחלקה מסוימת יכול להתקיים בתוכנית, בדומה לספרייה היחידה והיחידה בתרחיש העיר.
- _נקודת גישה מרכזית_: בדומה לכך שספריית העיר היחידה משמשת כמרכז לכל הפעילויות הקשורות לספרים, תבנית הסינגלטון מייעדת את האובייקט שהופעל כנקודת הגישה היחידה לשירות או למשאב המצוין ביישום.
- _נקודת ייחוס גלובלית_: כמו שספריית העיר משמשת כנקודת המפגש לכל צרכי הספרים, תבנית הסינגלטון מציעה נקודת ייחוס גלובלית אחת לאובייקט שהופעל, ומבטיחה שכל האינטראקציות עם השירות או המשאב יעברו דרכה.
- _מקום מנוהל_: כמו הניהול המרכזי של ספריית העיר להשאלת ושיתוף ספרים, תבנית הסינגלטון מקלה על גישה מבוקרת ושימוש באובייקט שהופעל, ומקדמת עקביות ותיאום בתוך היישום.

== דיאגרמות UML 
להלן, נסביר את מושג תבנית העיצוב של הסינגלטון באמצעות UML.

=== דיאגרמת מחלקה

image::SingletonPatternClassDiagram.png[title="דיאגרמת מחלקת הסינגלטון", align=center]

בדיאגרמת המחלקה הזו, המחלקה Singleton מייצגת את הספרייה המרכזית בעיר. בדיוק כמו הספרייה, המחלקה Singleton מבטיחה שרק מופע אחד של עצמה קיים ברחבי היישום. הבנאי הפרטי ומשתנה המופע הסטטי פועלים באופן דומה למעמד הייחודי של הספרייה ולנוכחותה הפיזית המוגבלת, ומבטיחים שלא ניתן ליצור מופעים נוספים. שיטת הgetInstance() משמשת ככניסה הראשית לספרייה, ומאפשרת גישה למופע ה-Singleton ומבטיחה שכל הבקשות למחלקת Singleton מופנות לאותו מופע, בדומה לכך שכל השאלת הספרים ושיתופם בעיר מנוהלים דרך הספרייה המרכזית.

=== דיאגרמת סדרה

image::SingletonPatternSequenceDiagram.png[title="דיאגרמת הסדרה של הסינגלטון", align=center]
בדיאגרמת הסדרה, האינטראקציה בין מחלקות הלקוח והסינגלטון מוצגת, בדומה לאדם המבקר בספרייה המרכזית של העיר. כאשר הלקוח שולח בקשה למחלקת הסינגלטון דרך שיטת הgetInstance(), הוא מפעיל את מחלקת הסינגלטון, מסמל אדם הנכנס לספרייה. אם לא קיים מופע של מחלקת הסינגלטון, מיוצג על ידי היעדר פטרון לספרייה, מחלקת הסינגלטון יוצרת מופע חדש, דומה לאדם שנכנס לספרייה לראשונה והופך לפטרון הראשון שלה. אך אם כבר קיים מופע, מוצג על ידי נוכחות של פטרון לספרייה, מחלקת הסינגלטון פשוט מחזירה את המופע הקיים, משקפת את האופן שבו אדם שחוזר לספרייה אינו מקבל כרטיס ספרייה חדש אלא ממשיך להשתמש בזה הקיים שלו. לבסוף, מחלקת הסינגלטון שולחת את המופע בחזרה ללקוח, מסמלת את הספרייה שמספקת גישה למשאביה, ולאחר מכן מפסיקה לפעול, בדומה לאדם שעוזב את הספרייה לאחר ביקורו. ההערה מסבירה שמחלקת הסינגלטון מבטיחה שנוצר ומוחזר מופע אחד בלבד, דומה למדיניות הספרייה שיש לה רק מיקום מרכזי אחד להשאלת ושיתוף ספרים.

== הדרכת יישום

בדוגמה זו, ניישם את תבנית הסינגלטון ב-Java באמצעות הדימוי של ספרייה. תבנית הסינגלטון מבטיחה שרק מופע אחד של מחלקה קיים ברחבי היישום.

=== מחלקת הספרייה - סינגלטון

[source, {lang}]
----
ifeval::["{lang}" == "java"]
include::{java_path}/singleton/Library.java[lines=3..]
endif::[]

ifeval::["{lang}" == "python"]
include::{python_path}/singleton/Library.py[lines=3..]
endif::[]
----

- מחלקת `Library` מייצגת את הספרייה המרכזית בדימוי שלנו.
- היא מכילה משתנה סטטי פרטי `uniqueInstance` לאחסון המופע היחיד של המחלקה.
- הבנאי פרטי, מבטיח ששום מחלקה אחרת לא יכולה ליצור אובייקט של `Library`.
- שיטת `getInstance()` היא שיטה סטטית שמחזירה את המופע היחיד של מחלקת `Library`. היא יוצרת מופע חדש אם אחד לא קיים, אחרת היא מחזירה את המופע הקיים.

=== לקוח

[source, {lang}]
----
ifeval::["{lang}" == "java"]
include::{java_path}/singleton/Client.java[lines=3..]
endif::[]

ifeval::["{lang}" == "python"]
include::{python_path}/singleton/Client.py[lines=3..]
endif::[]
----

- מחלקת `Client` מייצגת משתמש בספרייה בדימוי שלנו.
- בשיטת ה`main`, היא משיגה מופע של מחלקת `Library` באמצעות שיטת `getInstance()`.

=== הסבר
מחלקת `Library` מבטיחה שרק מופע אחד של עצמה קיים ברחבי היישום, בדיוק כמו הספרייה המרכזית בדימוי שלנו. שיטת `getInstance()` משמשת ככניסה הראשית לספרייה, מאפשרת גישה למופע `Singleton`. כאשר משתמש (שמיוצג על ידי מחלקת ה`Client`) מבקש גישה לספרייה, שיטת `getInstance()` בודקת אם כבר קיים מופע. אם כן, היא מחזירה את המופע הקיים; אם לא, היא יוצרת מופע חדש. בצורה זו, כל המשתמשים מתקשרים עם אותו מופע של הספרייה, מבטיחים גישה מרכזית למשאביה, בדומה לכך שכל השאלת ושיתוף הספרים בעיר מתרחשים דרך הספרייה המרכזית.
